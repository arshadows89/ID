<!-- if loged in -->
<% if current_user != nil %>

<style>
	textarea {
		width: 98%;
		margin: 10px;
	}
	#commentdelete {
		display: block !important;
		padding-left: 0 !important;
		font-size: 0 !important;
	}
</style>

<% 	def findcommenttime(thect)
	 	recenttime = Time.now - thect
	 	if recenttime < 60
	 		@commenttime = 'posted less than a min ago'
	 	elsif recenttime < 3600
	 		@commenttime = 'posted less than an hour ago'
	 	elsif recenttime < 86400
	 		@commenttime = 'posted less than a day ago'
	 	elsif recenttime < 604800
	 		@commenttime = 'posted less than a week ago'
	 	elsif recenttime < 2592000
	 		@commenttime = 'posted less than a month ago'
	 	elsif recenttime < 31536000
	 		@commenttime = 'posted less than a year ago'
	 	elsif recenttime >= 31536000
	 		@commenttime = 'posted more than a year ago'
	 	else
	 		@commenttime = 'an error occured'
	 	end
	end %>

<div id="forumtype">
	<%= @forum.title %>
</div>

<% @forum.posts.all_ordered_by_child.each do |forum| %>
	<div id="forumtypeforum" class="row">
		<div id="commentdelete">
			<% if current_user != nil %>
				<% if current_user == forum.user || current_user.admin %>
					<%= link_to image_tag('xicon.png'), forum_post_path(@forum, forum), method: :delete, data: { confirm: 'Are you sure?' } %>
				<% end %>
			<% end %>
		</div>
		<div id="forumtypeforumtitle" class='col-md-8 col-sd-8'>
			<%= link_to forum.title, forum_post_path(@forum.title ,forum) %>
		</div>
		<div id="forumtypeforumpccount" class='col-md-2 col-sd-2'>
			<div>Total Comments <%= forum.comments.count %></div>
		</div>
		<div id="forumtypeforumlastpost" class='col-md-2 col-sd-2'>

			<% if forum.comments.count == 0 %>
				<% @recenttime = Time.now - forum.updated_at %>
				<div>by <%= forum.user.username %></div>
			<% else %>
			 	<%=  forum.comments.order(:updated_at).last.body[0...25] %>
			 	<% if forum.comments.order(:updated_at).last.body.length > 25 %>
				...
			 	<% end %>
			 	<div>by <%= forum.comments.order(:updated_at).last.user.username %></div>
			 	<% @recenttime = Time.now - forum.comments.order(:updated_at).last.updated_at  %>
			<% end %>
			<div>				
				<% if @recenttime < 60 %>
			 		posted less than a min ago
			 	<% elsif @recenttime < 3600 %>
			 		posted less than an hour ago
			 	<% elsif @recenttime < 86400 %>
			 		posted less than a day ago
			 	<% elsif @recenttime < 604800 %>
			 		posted less than a week ago
			 	<% elsif @recenttime < 2592000 %>
			 		posted less than a month ago
			 	<% elsif @recenttime < 31536000 %>
			 		posted less than a year ago
			 	<% elsif @recenttime >= 31536000 %>
			 		posted more than a year ago
			 	<% else %>
			 		an error occured
			 	<% end %>
		 	</div>
		</div>
	</div>
<% end %>




<a name="commentsubmit"></a>
<div id="forumtypepost" class="row">
<% if @post.errors.any? %>
	<ul>
		<% @post.errors.full_messages.each do |message| %>

			 <li><%= message %></li>

		<% end %>
	</ul>

<% end %>

<%= form_for @post, url: forum_posts_path(@forum, :anchor => 'commentsubmit'), html: { :autocomplete => :off, :multipart => true, method: :post } do |f| %>
	<%= f.text_field :title, placeholder: "Post Title" %><br />
	<%= f.text_area :body, placeholder: "Comment Section", cols: "50", rows: "8"  %><br />
	<%= f.submit 'Submit', :class => 'guildbutton', :id => 'commentbutton'%>
	<br />
<br />
<% end %>
</div>

<% else %>
  <%= render 'shared/noaccess' %>  
<% end %>
















